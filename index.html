<!DOCTYPE html>
<html>
<head>
  <title>Link Generator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    button { padding: 10px 20px; cursor: pointer; }
    #cookiePopup {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      padding: 20px;
      border: 2px solid #ccc;
      display: none;
      z-index: 1000;
    }
    #cookiePopup button {
      background-color: green;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
    }
    .link-item { margin-bottom: 5px; }
  </style>
</head>
<body>
  <h1>Link Generator</h1>
  <button id="makeBtn">Make New</button>

  <h3>Bait Link:</h3>
  <p id="bait"></p>

  <h3>Admin Link:</h3>
  <p id="admin"></p>

  <h3>Previous Links:</h3>
  <div id="previousLinks"></div>

  <div id="cookiePopup">
    <p>
      By continuing you consent to accepting cookies. Blah blah blah who even cares about cookies like why should I waste my time making cookies and ye so just press the button below.
    </p>
    <button id="acceptCookies">Continue</button>
  </div>

  <script type="module">
    // Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "YOUR-API-KEY",
      authDomain: "YOUR-PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR-PROJECT.firebaseio.com",
      projectId: "YOUR-PROJECT",
      storageBucket: "YOUR-PROJECT.appspot.com",
      messagingSenderId: "SENDER-ID",
      appId: "APP-ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Cookie popup
    const cookiePopup = document.getElementById("cookiePopup");
    if (!localStorage.getItem("cookiesAccepted")) {
      cookiePopup.style.display = "block";
    }
    document.getElementById("acceptCookies").addEventListener("click", () => {
      localStorage.setItem("cookiesAccepted", "true");
      cookiePopup.style.display = "none";
    });

    function randomString(length) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      return Array.from({length}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
    }

    const previousLinksDiv = document.getElementById("previousLinks");
    let previousLinks = JSON.parse(localStorage.getItem("previousLinks") || "[]");

    function renderPreviousLinks() {
      previousLinksDiv.innerHTML = "";
      previousLinks.forEach(l => {
        const div = document.createElement("div");
        div.className = "link-item";
        div.innerHTML = `<strong>Bait:</strong> <a href="${l.bait}" target="_blank">${l.bait}</a><br>
                         <strong>Admin:</strong> <a href="${l.admin}" target="_blank">${l.admin}</a>`;
        previousLinksDiv.appendChild(div);
      });
    }
    renderPreviousLinks();

    async function makeNew() {
      const sessionId = randomString(8);
      const code = randomString(6);

      const basePath = window.location.origin + "/meow";
      const baitLink = basePath + "/user.html?id=" + sessionId;
      const adminLink = basePath + "/admin.html?id=" + sessionId + "&code=" + code;

      document.getElementById("bait").innerHTML = `<a href="${baitLink}" target="_blank">${baitLink}</a>`;
      document.getElementById("admin").innerHTML = `<a href="${adminLink}" target="_blank">${adminLink}</a>`;

      // Save session to Firebase
      await set(ref(db, "sessions/" + sessionId), {
        code: code,
        createdAt: Date.now()
      });

      // Save to localStorage
      previousLinks.push({ bait: baitLink, admin: adminLink });
      localStorage.setItem("previousLinks", JSON.stringify(previousLinks));
      renderPreviousLinks();
    }

    document.getElementById("makeBtn").addEventListener("click", makeNew);
  </script>
</body>
</html>
